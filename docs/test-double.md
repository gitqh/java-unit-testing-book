# 测试替身: Mock、Spy、Stub

对于一个应用程序或者一个系统而言，很难给你一个纯粹的类进行单元测试。对象之间的依赖往往交织到一起，需要拆成各个单元才能逐个击破，也是单元测试的目的。



需要将这些交织到一起的对象拆开，需要一些工具，例如模拟一些数据、替换一些具有某些特定行为的类等。  网站 xunitpatterns.com 把这些工具称为 Test Double，翻译过来就是”测试替身“。



Martin Fowler 为了让这些概念更容易理解，在他的网站上重新更加具体的定义了它们：



- **Dummy** 被用来仅仅作为填充参数列表的对象，实际上不会用到它们，对测试结果也没有任何影响。
- **Fake** 一些假的对象或者组件，测试过程中会被用到。例如内存数据库 h2，假的用于用户鉴权的 Bean，一般只会在测试环境下起作用，不会应用于生产。
- **Stubs** 为被测试对象提供数据，没有任何行为，往往是测试对象依赖关系的上游。
- **Spies** 被依赖对象的代理，行为往往由被代理的真实对象提供，代理的目的是为了断言程序运行的正确性。
- **Mocks** 模拟一个具有特性行为的对象，在测试开始前根据期望提供需要的结果。被测试对象往往调用这个对象的方法时，根据条件得到不同的输入，从而满足测试对象的不同场景。例如，mock 数据库的存储层，返回正常数据、空或者丢出异常等情况。



实际开发中，根据测试框架的实现，对定义有一部分出入。但大体上不会差太多，框架往往会提供 Mock、Spy 相关实现，Stub、Fake、Dummy 则需要自己配置或者实现。



下面这张图简单说明了这些测试替身分别有什么用，项目中不必全部引入，根据需要使用即可。





[TODO]



下面我们使用 Mokito 来测试依赖关系复杂的对象。



## Mokito 基本用法










# 测试静态、私有方法



## powermock 入门





## 神奇的 whitebox